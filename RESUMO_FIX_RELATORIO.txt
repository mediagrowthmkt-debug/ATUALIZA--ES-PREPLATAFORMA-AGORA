# RESUMO: Fix Stories/Posts em ProduÃ§Ã£o + Como Usar Corretamente

## âš¡ Problema
Stories e posts carregavam no VS Code Live Preview mas NÃƒO no domÃ­nio em produÃ§Ã£o.

## â— IMPORTANTE: VOCÃŠ ESTÃ USANDO O LINK CORRETO?

### âŒ ERRADO (nÃ£o funciona em produÃ§Ã£o):
```
https://seu-dominio.com/relatorio.html?mes=2025-10&tenant=CLIENTE
```

### âœ… CORRETO (funciona em produÃ§Ã£o):
```
https://seu-dominio.com/relatorio.html?share=abc123xyz&tenant=CLIENTE&mes=2025-10
```

## ğŸ¯ Como Gerar o Link Correto

1. Acesse o painel: `https://seu-dominio.com/?client=SEU_CLIENTE`
2. FaÃ§a login com Google
3. VÃ¡ atÃ© a seÃ§Ã£o "ï¿½ RelatÃ³rio do mÃªs"
4. Selecione o mÃªs desejado
5. Clique no botÃ£o **"ğŸ”— Copiar link"**
6. Use o link copiado (tem `?share=TOKEN`)

## ï¿½ğŸ”§ CorreÃ§Ãµes Aplicadas

### relatorio.html
1. âœ… Removido `crossOrigin='anonymous'` (causava erro CORS)
2. âœ… ForÃ§ar HTTPS em URLs do Firebase Storage
3. âœ… Timeout aumentado: 10s â†’ 15s
4. âœ… Lazy loading nas imagens (`loading="lazy"`)
5. âœ… Error handler global para imagens
6. âœ… Fallback visual (ğŸ“· e â–¶) quando mÃ­dia falha
7. âœ… Logs detalhados no console para debug
8. âœ… Mensagem clara quando falta token de compartilhamento

### netlify.toml (NOVO)
1. âœ… Headers CORS para imagens/vÃ­deos
2. âœ… Force HTTPS redirect
3. âœ… Cache otimizado

## ğŸš€ Deploy

```bash
git add .
git commit -m "fix: relatorio com logs debug e instruÃ§Ãµes de uso correto"
git push origin main
```

## âœ… Teste no DomÃ­nio

1. Acesse: `https://seu-dominio.com/?client=SEU_CLIENTE`
2. FaÃ§a login
3. VÃ¡ atÃ© "RelatÃ³rio do mÃªs"
4. Clique em "ğŸ”— Copiar link"
5. Abra o link em aba anÃ´nima (Ctrl+Shift+N)
6. Abra DevTools (F12) â†’ Console
7. Procure por: `[Relatorio] Modo pÃºblico - carregando via shareToken`
8. Stories e posts devem aparecer!

## ğŸ› Debug

Se ainda nÃ£o funcionar, veja os logs no console:

**Com token (correto)**:
```
[Relatorio] Modo pÃºblico - carregando via shareToken: abc123
[Relatorio] Payload carregado: {hasStories: 5, hasPosts: 12}
```

**Sem token (incorreto)**:
```
[Relatorio] Modo autenticado - aguardando login...
[Relatorio] IMPORTANTE: Para acesso pÃºblico use o botÃ£o "Copiar link"...
```

## ğŸ†˜ Se Ainda NÃ£o Funcionar

1. **Verifique se o link TEM o parÃ¢metro `?share=...`**
2. **Gere um NOVO link** pelo botÃ£o "Copiar link"
3. **Confira os logs** no console (F12)
4. **Compartilhe os logs** comigo para anÃ¡lise

**Firebase Storage Rules** - Garanta leitura pÃºblica:
```
allow read: if true;
```

**Aplique CORS no bucket**:
```bash
gsutil cors set cors.json gs://mediagrowth-a5349.firebasestorage.app
```

---
ğŸ“„ Detalhes completos: `FIX_RELATORIO_PRODUCAO.md`
ğŸ“– Guia de uso: `COMO_USAR_RELATORIO.md`
