<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Relat√≥rio de An√°lises ‚Ä¢ MediaGrowth</title>
  <link rel="icon" type="image/png" href="favicon.png"/>
  <style>
    :root {
      color-scheme: dark;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      --sidebar-width: 280px;
      --header-height: 70px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, rgba(16,185,129,0.14), transparent 55%), #0f172a;
      color: #f8fafc;
    }
    .hidden { display: none !important; }
    
    /* Loading e Erro */
    .loading, .error {
      margin-top: 120px;
      text-align: center;
      font-size: 1.1rem;
      color: #cbd5f5;
    }
    .loading .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid rgba(255,255,255,.1);
      border-top-color: #10b981;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .error h2 { margin-bottom: 12px; font-size: 1.6rem; color: #fca5a5; }

    /* Header Fixo */
    .main-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--header-height);
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(148, 163, 184, 0.15);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      z-index: 1000;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: #e2e8f0;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 8px;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #10b981, #059669);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    .logo-text {
      font-size: 1.25rem;
      font-weight: 700;
      color: #f8fafc;
    }
    .header-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .client-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: #e2e8f0;
    }
    .report-date {
      font-size: 0.75rem;
      color: #94a3b8;
    }
    .header-actions {
      display: flex;
      gap: 12px;
    }
    .btn-header {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    .btn-pdf {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }
    .btn-pdf:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    /* Layout Principal */
    .main-container {
      display: flex;
      padding-top: var(--header-height);
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: var(--header-height);
      left: 0;
      width: var(--sidebar-width);
      height: calc(100vh - var(--header-height));
      background: rgba(15, 23, 42, 0.98);
      border-right: 1px solid rgba(148, 163, 184, 0.15);
      overflow-y: auto;
      z-index: 900;
      transition: transform 0.3s ease;
    }
    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }
    .sidebar-title {
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #64748b;
      margin: 0;
    }
    .sidebar-nav {
      padding: 12px 0;
    }
    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
      text-decoration: none;
      color: #cbd5e1;
      font-size: 0.88rem;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
      border-left: 3px solid transparent;
    }
    .nav-item:hover {
      background: rgba(148, 163, 184, 0.08);
      color: #f1f5f9;
    }
    .nav-item.active {
      background: rgba(16, 185, 129, 0.15);
      color: #6ee7b7;
      border-left-color: #10b981;
    }
    .nav-item-icon {
      font-size: 1.1rem;
      width: 28px;
      text-align: center;
    }
    .nav-item-text {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .nav-item-number {
      font-size: 0.7rem;
      background: rgba(100, 116, 139, 0.3);
      padding: 2px 8px;
      border-radius: 10px;
      color: #94a3b8;
    }
    .nav-item.active .nav-item-number {
      background: rgba(16, 185, 129, 0.3);
      color: #6ee7b7;
    }

    /* Conte√∫do Principal */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: 30px 40px;
      max-width: calc(100% - var(--sidebar-width));
      overflow-x: hidden;
    }

    /* Se√ß√µes do Relat√≥rio */
    .report-section {
      margin-bottom: 50px;
      scroll-margin-top: calc(var(--header-height) + 20px);
      max-width: 950px;
    }
    .section-header {
      margin-bottom: 20px;
      padding-bottom: 14px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.15);
    }
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #10b981, #059669);
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 700;
      color: white;
      margin-right: 12px;
    }
    .section-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: #f1f5f9;
      margin: 0;
      display: inline-flex;
      align-items: center;
    }
    .section-meta {
      margin-top: 8px;
      font-size: 0.78rem;
      color: #64748b;
    }

    /* Conte√∫do da An√°lise */
    .analysis-content {
      background: rgba(30, 41, 59, 0.5);
      border-radius: 12px;
      padding: 24px 28px;
      border: 1px solid rgba(148, 163, 184, 0.1);
      max-width: 100%;
      overflow-x: auto;
    }
    
    /* Esconder bot√µes de IA e lixeira que v√™m do conte√∫do */
    .analysis-content .analise-bloco-btns,
    .analysis-content .analise-bloco-regen-btn,
    .analysis-content .analise-bloco-delete-btn,
    .analysis-content .ia-action-bar,
    .analysis-content .ia-expand-btn,
    .analysis-content .ia-delete-btn,
    .analysis-content [class*="regen-btn"],
    .analysis-content [class*="delete-btn"],
    .analysis-content [class*="bloco-btns"] {
      display: none !important;
    }
    
    /* Remover wrappers extras */
    .analysis-content .analise-bloco-wrapper {
      display: contents;
    }
    
    /* Esconder qualquer bot√£o restante por fallback CSS */
    .analysis-content button,
    .analysis-content [onclick],
    .analysis-content [class*="btn"] {
      display: none !important;
    }
    
    .analysis-content h1,
    .analysis-content h2,
    .analysis-content h3,
    .analysis-content h4 {
      color: #f1f5f9;
      margin-top: 1.5em;
      margin-bottom: 0.5em;
      font-weight: 700;
      line-height: 1.35;
    }
    .analysis-content h1:first-child,
    .analysis-content h2:first-child,
    .analysis-content h3:first-child {
      margin-top: 0;
    }
    .analysis-content h1 { font-size: 1.25rem; }
    .analysis-content h2 { font-size: 1.1rem; color: #6ee7b7; }
    .analysis-content h3 { font-size: 0.95rem; color: #a5b4fc; }
    .analysis-content h4 { font-size: 0.9rem; color: #94a3b8; }
    .analysis-content p {
      color: #cbd5e1;
      line-height: 1.65;
      margin-bottom: 0.75em;
      font-size: 0.88rem;
    }
    .analysis-content ul, .analysis-content ol {
      color: #cbd5e1;
      padding-left: 1.4em;
      margin-bottom: 0.9em;
      font-size: 0.88rem;
    }
    .analysis-content li {
      margin-bottom: 0.35em;
      line-height: 1.55;
    }
    .analysis-content strong {
      color: #f8fafc;
      font-weight: 600;
    }
    .analysis-content em {
      color: #6ee7b7;
      font-style: italic;
    }
    
    /* Tabelas - estilo planilha profissional e compacta */
    .analysis-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 1em 0;
      font-size: 0.78rem;
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.2);
    }
    .analysis-content th {
      background: rgba(99, 102, 241, 0.15);
      color: #a5b4fc;
      font-weight: 600;
      padding: 8px 10px;
      text-align: left;
      border-bottom: 2px solid rgba(99, 102, 241, 0.3);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.02em;
      white-space: nowrap;
    }
    .analysis-content td {
      padding: 7px 10px;
      text-align: left;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      vertical-align: top;
      font-size: 0.78rem;
    }
    .analysis-content tr:nth-child(even) {
      background: rgba(30, 41, 59, 0.3);
    }
    .analysis-content tr:hover {
      background: rgba(99, 102, 241, 0.08);
    }
    
    /* Overflow para tabelas largas */
    .analysis-content > div:has(table) {
      overflow-x: auto;
    }
    
    .analysis-content blockquote {
      border-left: 3px solid #10b981;
      background: rgba(16, 185, 129, 0.08);
      padding: 12px 16px;
      margin: 1em 0;
      border-radius: 0 8px 8px 0;
      font-size: 0.85rem;
    }
    .analysis-content code {
      background: rgba(99, 102, 241, 0.15);
      color: #a5b4fc;
      padding: 1px 5px;
      border-radius: 3px;
      font-size: 0.82em;
    }
    .analysis-content pre {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.15);
      border-radius: 8px;
      padding: 14px;
      overflow-x: auto;
      font-size: 0.8rem;
    }

    /* Capa Inicial */
    .cover-section {
      text-align: center;
      padding: 60px 40px;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(99, 102, 241, 0.1));
      border-radius: 24px;
      border: 1px solid rgba(16, 185, 129, 0.2);
      margin-bottom: 40px;
    }
    .cover-logo {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #10b981, #059669);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      margin: 0 auto 18px;
    }
    .cover-title {
      font-size: 1.7rem;
      font-weight: 800;
      color: #f1f5f9;
      margin: 0 0 10px;
    }
    .cover-subtitle {
      font-size: 0.95rem;
      color: #94a3b8;
      margin: 0 0 18px;
    }
    .cover-client {
      display: inline-block;
      padding: 8px 20px;
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 999px;
      color: #6ee7b7;
      font-weight: 600;
      font-size: 0.9rem;
    }
    .cover-stats {
      display: flex;
      justify-content: center;
      gap: 28px;
      margin-top: 24px;
    }
    .stat-item {
      text-align: center;
    }
    .stat-value {
      font-size: 1.6rem;
      font-weight: 700;
      color: #10b981;
    }
    .stat-label {
      font-size: 0.7rem;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Responsivo - Tablet */
    @media (max-width: 1024px) {
      :root {
        --sidebar-width: 240px;
      }
      .main-content {
        padding: 24px;
        max-width: calc(100% - 240px);
      }
      .analysis-content {
        padding: 24px;
      }
    }

    /* Responsivo - Mobile */
    @media (max-width: 768px) {
      :root {
        --header-height: 60px;
      }
      
      /* Header Mobile */
      .main-header {
        padding: 0 12px;
      }
      .menu-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
      }
      .logo-icon {
        width: 32px;
        height: 32px;
        font-size: 1rem;
        border-radius: 8px;
      }
      .logo-text {
        font-size: 1rem;
      }
      .header-info {
        display: none;
      }
      .header-actions {
        gap: 8px;
      }
      .btn-header {
        padding: 8px 12px;
        font-size: 0.75rem;
      }
      .btn-pdf {
        padding: 8px 14px;
      }
      
      /* Sidebar Mobile */
      .sidebar {
        transform: translateX(-100%);
        width: 280px;
      }
      .sidebar.open {
        transform: translateX(0);
      }
      
      /* Conte√∫do Mobile */
      .main-content {
        margin-left: 0;
        padding: 16px;
        max-width: 100%;
      }
      
      /* Capa Mobile */
      .cover-section {
        padding: 30px 20px;
        border-radius: 16px;
        margin-bottom: 24px;
      }
      .cover-logo {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
        border-radius: 12px;
        margin-bottom: 14px;
      }
      .cover-title {
        font-size: 1.3rem;
        line-height: 1.3;
      }
      .cover-subtitle {
        font-size: 0.85rem;
        margin-bottom: 14px;
      }
      .cover-client {
        font-size: 0.85rem;
        padding: 6px 16px;
      }
      .cover-stats {
        flex-direction: row;
        gap: 24px;
        margin-top: 20px;
      }
      .stat-value {
        font-size: 1.3rem;
      }
      .stat-label {
        font-size: 0.65rem;
      }
      
      /* Se√ß√µes Mobile */
      .report-section {
        margin-bottom: 30px;
      }
      .section-header {
        margin-bottom: 14px;
        padding-bottom: 10px;
      }
      .section-number {
        width: 28px;
        height: 28px;
        font-size: 0.8rem;
        margin-right: 10px;
      }
      .section-title {
        font-size: 1rem;
      }
      .section-meta {
        font-size: 0.7rem;
      }
      
      /* Imagem do Entreg√°vel Mobile */
      .entregavel-image {
        border-radius: 10px;
        margin-bottom: 12px;
      }
      
      /* Conte√∫do da An√°lise Mobile */
      .analysis-content {
        padding: 16px;
        border-radius: 10px;
      }
      .analysis-content h1 { font-size: 1.1rem; }
      .analysis-content h2 { font-size: 1rem; }
      .analysis-content h3 { font-size: 0.9rem; }
      .analysis-content h4 { font-size: 0.85rem; }
      .analysis-content p,
      .analysis-content ul,
      .analysis-content ol,
      .analysis-content li {
        font-size: 0.82rem;
        line-height: 1.55;
      }
      
      /* Tabelas Mobile */
      .analysis-content table {
        font-size: 0.7rem;
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      .analysis-content th {
        padding: 6px 8px;
        font-size: 0.65rem;
      }
      .analysis-content td {
        padding: 5px 8px;
        font-size: 0.7rem;
      }
      
      /* M√≠dias Tagueadas Mobile */
      .analysis-content .midias-tagueadas-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 8px !important;
      }
      .analysis-content .midias-tagueadas-grid img,
      .analysis-content .midias-tagueadas-grid video {
        height: 80px !important;
      }
      
      /* Navega√ß√£o Mobile */
      .nav-item {
        padding: 12px 16px;
        font-size: 0.85rem;
      }
      .nav-item-icon {
        font-size: 1rem;
        width: 24px;
      }
      .nav-item-number {
        font-size: 0.65rem;
        padding: 2px 6px;
      }
    }
    
    /* Responsivo - Mobile Pequeno */
    @media (max-width: 480px) {
      .main-content {
        padding: 12px;
      }
      .cover-section {
        padding: 24px 16px;
      }
      .cover-title {
        font-size: 1.15rem;
      }
      .cover-stats {
        gap: 20px;
      }
      .stat-value {
        font-size: 1.2rem;
      }
      .section-title {
        font-size: 0.95rem;
      }
      .analysis-content {
        padding: 14px;
      }
      .analysis-content p,
      .analysis-content li {
        font-size: 0.8rem;
      }
      .analysis-content .midias-tagueadas-grid {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      .analysis-content .midias-tagueadas-grid img,
      .analysis-content .midias-tagueadas-grid video {
        height: 70px !important;
      }
    }

    /* Overlay para mobile */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: var(--header-height);
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 850;
    }
    .sidebar-overlay.open {
      display: block;
    }

    /* Imagens de Entreg√°veis nas capas dos cap√≠tulos */
    .entregavel-image {
      width: 100%;
      height: auto;
      border-radius: 12px;
      margin-bottom: 16px;
      border: 1px solid rgba(148, 163, 184, 0.15);
    }
    
    /* Imagens dentro do conte√∫do da an√°lise (m√≠dias tagueadas) */
    .analysis-content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 8px 0;
      border: 1px solid rgba(148, 163, 184, 0.2);
    }
    
    /* Se√ß√£o de M√≠dias Tagueadas */
    .analysis-content .midias-tagueadas-section {
      background: linear-gradient(135deg, rgba(34,197,94,0.1) 0%, rgba(16,185,129,0.1) 100%) !important;
      border-radius: 12px !important;
      padding: 20px !important;
      margin: 20px 0 !important;
      border: 1px solid rgba(34,197,94,0.3) !important;
    }
    
    .analysis-content .midias-tagueadas-section h3 {
      color: #86efac !important;
      margin: 0 0 12px 0 !important;
      font-size: 1rem !important;
    }
    
    .analysis-content .midias-tagueadas-section p {
      color: rgba(255,255,255,0.7) !important;
      font-size: 0.8rem !important;
      margin: 0 0 12px 0 !important;
    }
    
    /* Grid de m√≠dias tagueadas */
    .analysis-content .midias-tagueadas-grid {
      display: grid !important;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)) !important;
      gap: 10px !important;
      margin: 12px 0 0 0 !important;
    }
    
    .analysis-content .midias-tagueadas-grid img,
    .analysis-content .midias-tagueadas-grid video {
      width: 100% !important;
      height: 100px !important;
      object-fit: cover !important;
      border-radius: 8px !important;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      border: 1px solid rgba(148, 163, 184, 0.2) !important;
      margin: 0 !important;
    }
    
    .analysis-content .midias-tagueadas-grid img:hover,
    .analysis-content .midias-tagueadas-grid video:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
    }
    
    /* Limpar elementos que v√™m no HTML das an√°lises */
    .analysis-content > div:first-child:empty,
    .analysis-content > span:empty,
    .analysis-content > br:first-child {
      display: none;
    }
    
    /* Garantir que links s√£o clic√°veis */
    .analysis-content a {
      color: #6ee7b7;
      text-decoration: underline;
    }
    .analysis-content a:hover {
      color: #a5b4fc;
    }
    
    /* Estilos de Impress√£o / PDF */
    @media print {
      body {
        background: white !important;
        color: #1e293b !important;
      }
      .main-header,
      .sidebar,
      .sidebar-overlay,
      .menu-toggle,
      .btn-pdf {
        display: none !important;
      }
      .main-content {
        margin-left: 0 !important;
        padding: 20px !important;
        max-width: 100% !important;
      }
      .cover-section {
        background: #f8fafc !important;
        border-color: #e2e8f0 !important;
        page-break-after: always;
      }
      .cover-title,
      .section-title {
        color: #1e293b !important;
      }
      .cover-client {
        background: #dcfce7 !important;
        color: #166534 !important;
        border-color: #86efac !important;
      }
      .stat-value {
        color: #059669 !important;
      }
      .analysis-content {
        background: #f8fafc !important;
        border-color: #e2e8f0 !important;
        page-break-inside: avoid;
      }
      .analysis-content h1,
      .analysis-content h2,
      .analysis-content h3,
      .analysis-content h4,
      .analysis-content p,
      .analysis-content li {
        color: #334155 !important;
      }
      .analysis-content h2 {
        color: #059669 !important;
      }
      .report-section {
        page-break-inside: avoid;
      }
      .entregavel-image {
        max-height: 300px;
        object-fit: contain;
      }
    }
  </style>
</head>
<body>

  <!-- Loading -->
  <div id="loading" class="loading">
    <div class="spinner"></div>
    <div>Carregando relat√≥rio...</div>
  </div>

  <!-- Erro -->
  <div id="error" class="error hidden">
    <h2>‚ùå Erro</h2>
    <p id="errorMessage">N√£o foi poss√≠vel carregar o relat√≥rio.</p>
  </div>

  <!-- Conte√∫do Principal -->
  <div id="content" class="hidden">
    <!-- Header -->
    <header class="main-header">
      <div class="header-left">
        <button class="menu-toggle" id="menuToggle" aria-label="Abrir menu">‚ò∞</button>
        <div class="logo">
          <div class="logo-icon">üìä</div>
          <span class="logo-text">MediaGrowth</span>
        </div>
        <div class="header-info">
          <span class="client-name" id="headerClientName">Cliente</span>
          <span class="report-date" id="headerDate">Relat√≥rio de An√°lises</span>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn-header btn-pdf" onclick="window.print()">
          üì• Baixar PDF
        </button>
      </div>
    </header>

    <!-- Sidebar Overlay (mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Container Principal -->
    <div class="main-container">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h2 class="sidebar-title">üìë Sum√°rio</h2>
        </div>
        <nav class="sidebar-nav" id="sidebarNav">
          <!-- Navega√ß√£o din√¢mica -->
        </nav>
      </aside>

      <!-- Conte√∫do -->
      <main class="main-content" id="mainContent">
        <!-- Capa -->
        <section class="cover-section" id="coverSection">
          <div class="cover-logo">üìä</div>
          <h1 class="cover-title">Relat√≥rio Completo de An√°lises</h1>
          <p class="cover-subtitle">An√°lise estrat√©gica personalizada para seu neg√≥cio</p>
          <div class="cover-client" id="coverClient">Cliente</div>
          <div class="cover-stats">
            <div class="stat-item">
              <div class="stat-value" id="statAnalises">0</div>
              <div class="stat-label">An√°lises</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="statDate">--</div>
              <div class="stat-label">Data</div>
            </div>
          </div>
        </section>

        <!-- Se√ß√µes de An√°lise (din√¢micas) -->
        <div id="analysisContainer">
          <!-- Conte√∫do din√¢mico -->
        </div>
      </main>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD4CbPQWrwOcfANX3ar0ibmGN20ffsRCqo",
      authDomain: "mediagrowth-a5349.firebaseapp.com",
      projectId: "mediagrowth-a5349",
      storageBucket: "mediagrowth-a5349.firebasestorage.app",
      messagingSenderId: "1074237637946",
      appId: "1:1074237637946:web:cf5008b649bbb4d7d13c03"
    };

    const qs = new URLSearchParams(location.search);
    const token = qs.get('token');

    const loadingEl = document.getElementById('loading');
    const contentEl = document.getElementById('content');
    const errorEl = document.getElementById('error');
    const errorMessageEl = document.getElementById('errorMessage');

    // Imagens dos entreg√°veis
    const ENTREGAVEL_IMAGES = {
      'diagnostico_estrategico': 'assets/entregaveis mediagrwoth/Diagn√≥stico Estrat√©gico Completo.png',
      'direcionamento_metas': 'assets/entregaveis mediagrwoth/Direcionamento Estrat√©gico e Metas.png',
      'analise_concorrencia': 'assets/entregaveis mediagrwoth/An√°lise de Concorr√™ncia e Mercado.png',
      'matriz_cdt': 'assets/entregaveis mediagrwoth/matriz cdt.png',
      'puv': 'assets/entregaveis mediagrwoth/puv Proposta √∫nica de valor.png',
      'pai': 'assets/entregaveis mediagrwoth/p.a.i p√∫blico alvo ideal.png',
      'anuncios_pagos': 'assets/entregaveis mediagrwoth/estrutura√ß√£o  an√∫ncios pagos.png',
      'site_seo': 'assets/entregaveis mediagrwoth/Estrutura√ß√£o  Site & SEO.png',
      'redes_sociais': 'assets/entregaveis mediagrwoth/Estrat√©gias para as  Redes Sociais.png',
      'copywriting': 'assets/entregaveis mediagrwoth/Copywriting Estrat√©gico.png',
      'producao_conteudo': 'assets/entregaveis mediagrwoth/Produ√ß√£o de Conte√∫do Guiada.png',
      'criativos_anuncios': 'assets/entregaveis mediagrwoth/Criativos para  an√∫ncios patrocinados.png',
      'crm_automacoes': 'assets/entregaveis mediagrwoth/acesso CRM e Automa√ß√µes.png',
      'processo_comercial': 'assets/entregaveis mediagrwoth/Estrutura√ß√£o do Processo Comercial.png',
      'landing_pages': 'assets/entregaveis mediagrwoth/Landing pages estrat√©gicas.png',
      'website': 'assets/entregaveis mediagrwoth/Constru√ß√£o ou atualiza√ß√£o de website.png',
      'padronizacao_visual': 'assets/entregaveis mediagrwoth/Padroniza√ß√£o visual  e de comunica√ß√£o.png',
      'plataforma_mediagrowth': 'assets/entregaveis mediagrwoth/_plataforma mediagrowth.png'
    };

    // √çcones dos entreg√°veis
    const ENTREGAVEL_ICONS = {
      diagnostico_estrategico: 'üéØ',
      direcionamento_metas: 'üß≠',
      analise_concorrencia: 'üîç',
      matriz_cdt: 'üìä',
      puv: 'üíé',
      pai: 'üë•',
      anuncios_pagos: 'üì¢',
      site_seo: 'üåê',
      redes_sociais: 'üì±',
      copywriting: '‚úçÔ∏è',
      producao_conteudo: 'üé¨',
      criativos_anuncios: 'üé®',
      crm_automacoes: '‚öôÔ∏è',
      processo_comercial: 'üíº',
      landing_pages: 'üìÑ',
      website: 'üñ•Ô∏è',
      padronizacao_visual: 'üé≠',
      plataforma_mediagrowth: 'üöÄ'
    };

    function showError(msg) {
      loadingEl.classList.add('hidden');
      contentEl.classList.add('hidden');
      errorEl.classList.remove('hidden');
      errorMessageEl.textContent = msg;
    }

    function formatDate(isoString) {
      if (!isoString) return '--';
      const date = new Date(isoString);
      const dia = date.getDate().toString().padStart(2, '0');
      const mes = (date.getMonth() + 1).toString().padStart(2, '0');
      const ano = date.getFullYear();
      return `${dia}/${mes}/${ano}`;
    }

    function formatDateTime(isoString) {
      if (!isoString) return '--';
      const date = new Date(isoString);
      const dia = date.getDate().toString().padStart(2, '0');
      const mes = (date.getMonth() + 1).toString().padStart(2, '0');
      const ano = date.getFullYear();
      const hora = date.getHours().toString().padStart(2, '0');
      const min = date.getMinutes().toString().padStart(2, '0');
      return `${dia}/${mes}/${ano} √†s ${hora}:${min}`;
    }

    // Fun√ß√£o para limpar HTML das an√°lises (remover bot√µes, elementos interativos)
    function limparHtmlAnalise(html) {
      if (!html) return '';
      
      // Criar um elemento tempor√°rio para manipular o DOM
      const temp = document.createElement('div');
      temp.innerHTML = html;
      
      // Remover bot√µes de IA+ e lixeira
      const botoesParaRemover = temp.querySelectorAll([
        '.analise-bloco-btns',
        '.analise-bloco-regen-btn',
        '.analise-bloco-delete-btn',
        'button',
        '[onclick]',
        '[class*="regen"]',
        '[class*="delete-btn"]',
        '[class*="bloco-btns"]'
      ].join(','));
      
      botoesParaRemover.forEach(el => el.remove());
      
      // Remover divs vazias de wrapper
      const wrappers = temp.querySelectorAll('.analise-bloco-wrapper');
      wrappers.forEach(wrapper => {
        // Mover conte√∫do para fora do wrapper
        while (wrapper.firstChild) {
          wrapper.parentNode.insertBefore(wrapper.firstChild, wrapper);
        }
        wrapper.remove();
      });
      
      // Remover textos de placeholder
      let cleanHtml = temp.innerHTML;
      cleanHtml = cleanHtml.replace(/üí°\s*Clique nas m√≠dias para ampliar[^<]*/gi, '');
      cleanHtml = cleanHtml.replace(/As descri√ß√µes s√£o usadas pela IA na gera√ß√£o da an√°lise/gi, '');
      
      return cleanHtml;
    }

    if (!token) {
      showError('O link informado √© inv√°lido ou expirou. Solicite um novo link.');
      throw new Error('Token ausente');
    }

    const app = getApps().find(a => a.name === 'relatorio-compartilhado') || initializeApp(firebaseConfig, 'relatorio-compartilhado');
    const db = getFirestore(app);
    const relatorioRef = doc(db, 'relatoriosCompartilhados', token);

    async function init() {
      try {
        const snap = await getDoc(relatorioRef);
        if (!snap.exists()) {
          showError('Este link de relat√≥rio n√£o existe ou foi removido.');
          return;
        }

        const data = snap.data();
        const analises = data.analises || {};
        const clientName = data.clientName || 'Cliente';
        const createdAt = data.createdAt;

        // Atualizar header
        document.getElementById('headerClientName').textContent = clientName;
        document.getElementById('headerDate').textContent = `Gerado em ${formatDate(createdAt)}`;

        // Atualizar capa
        document.getElementById('coverClient').textContent = clientName;
        document.getElementById('statAnalises').textContent = Object.keys(analises).length;
        document.getElementById('statDate').textContent = formatDate(createdAt);

        // Ordenar entreg√°veis pela ordem definida
        const ORDER = [
          'diagnostico_estrategico',
          'direcionamento_metas',
          'analise_concorrencia',
          'matriz_cdt',
          'puv',
          'pai',
          'anuncios_pagos',
          'site_seo',
          'redes_sociais',
          'copywriting',
          'producao_conteudo',
          'criativos_anuncios',
          'crm_automacoes',
          'processo_comercial',
          'landing_pages',
          'website',
          'padronizacao_visual',
          'plataforma_mediagrowth'
        ];

        const sortedKeys = Object.keys(analises).sort((a, b) => {
          const indexA = ORDER.indexOf(a);
          const indexB = ORDER.indexOf(b);
          return (indexA === -1 ? 999 : indexA) - (indexB === -1 ? 999 : indexB);
        });

        // Construir sidebar
        const sidebarNav = document.getElementById('sidebarNav');
        let sidebarHtml = `
          <a class="nav-item active" href="#coverSection" data-section="coverSection">
            <span class="nav-item-icon">üìã</span>
            <span class="nav-item-text">Capa</span>
          </a>
        `;

        sortedKeys.forEach((entregavelId, index) => {
          const analise = analises[entregavelId];
          const icon = ENTREGAVEL_ICONS[entregavelId] || 'üìÑ';
          const title = analise.title || entregavelId;
          const sectionId = `section-${entregavelId}`;
          sidebarHtml += `
            <a class="nav-item" href="#${sectionId}" data-section="${sectionId}">
              <span class="nav-item-icon">${icon}</span>
              <span class="nav-item-text">${title}</span>
              <span class="nav-item-number">${index + 1}</span>
            </a>
          `;
        });
        sidebarNav.innerHTML = sidebarHtml;

        // Construir se√ß√µes de an√°lise
        const container = document.getElementById('analysisContainer');
        let sectionsHtml = '';

        sortedKeys.forEach((entregavelId, index) => {
          const analise = analises[entregavelId];
          const icon = ENTREGAVEL_ICONS[entregavelId] || 'üìÑ';
          const title = analise.title || entregavelId;
          const imagePath = ENTREGAVEL_IMAGES[entregavelId];
          const sectionId = `section-${entregavelId}`;
          
          // Limpar HTML removendo bot√µes e elementos indesejados
          let cleanHtml = limparHtmlAnalise(analise.insightHtml || '');

          sectionsHtml += `
            <section class="report-section" id="${sectionId}">
              ${imagePath ? `<img src="${imagePath}" alt="${title}" class="entregavel-image" onerror="this.style.display='none'">` : ''}
              <div class="section-header">
                <h2 class="section-title">
                  <span class="section-number">${index + 1}</span>
                  ${icon} ${title}
                </h2>
                <div class="section-meta">
                  üìÖ Gerado em: ${formatDateTime(analise.generatedAt)}
                </div>
              </div>
              <div class="analysis-content">
                ${cleanHtml || '<p>Conte√∫do n√£o dispon√≠vel.</p>'}
              </div>
            </section>
          `;
        });
        container.innerHTML = sectionsHtml;

        // Navega√ß√£o da sidebar
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            const sectionId = item.dataset.section;
            const section = document.getElementById(sectionId);
            if (section) {
              section.scrollIntoView({ behavior: 'smooth' });
              // Fechar sidebar no mobile
              closeSidebar();
            }
            // Atualizar item ativo
            navItems.forEach(n => n.classList.remove('active'));
            item.classList.add('active');
          });
        });

        // Highlight section on scroll
        const sections = document.querySelectorAll('.report-section, .cover-section');
        const observerOptions = {
          root: null,
          rootMargin: '-100px 0px -50% 0px',
          threshold: 0
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const sectionId = entry.target.id;
              navItems.forEach(n => {
                n.classList.toggle('active', n.dataset.section === sectionId);
              });
            }
          });
        }, observerOptions);

        sections.forEach(section => observer.observe(section));

        // Mostrar conte√∫do
        loadingEl.classList.add('hidden');
        contentEl.classList.remove('hidden');

      } catch (err) {
        console.error('Erro ao carregar relat√≥rio:', err);
        showError('Ocorreu um erro ao carregar o relat√≥rio. Tente novamente mais tarde.');
      }
    }

    // Toggle sidebar mobile
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');

    function openSidebar() {
      sidebar.classList.add('open');
      sidebarOverlay.classList.add('open');
    }

    function closeSidebar() {
      sidebar.classList.remove('open');
      sidebarOverlay.classList.remove('open');
    }

    menuToggle?.addEventListener('click', () => {
      if (sidebar.classList.contains('open')) {
        closeSidebar();
      } else {
        openSidebar();
      }
    });

    sidebarOverlay?.addEventListener('click', closeSidebar);

    // Inicializar
    init();
  </script>

  <!-- Print Styles -->
  <style>
    @media print {
      .main-header,
      .sidebar,
      .sidebar-overlay,
      .menu-toggle {
        display: none !important;
      }
      .main-content {
        margin-left: 0 !important;
        padding: 20px !important;
      }
      .main-container {
        padding-top: 0 !important;
      }
      .report-section {
        page-break-inside: avoid;
        break-inside: avoid;
      }
      .cover-section {
        page-break-after: always;
      }
      body {
        background: white !important;
        color: #1e293b !important;
      }
      .cover-section {
        background: #f8fafc !important;
        border-color: #e2e8f0 !important;
      }
      .analysis-content {
        background: #f8fafc !important;
        border-color: #e2e8f0 !important;
      }
      .analysis-content h1,
      .analysis-content h2,
      .analysis-content h3,
      .analysis-content h4,
      .section-title,
      .cover-title {
        color: #1e293b !important;
      }
      .analysis-content p,
      .analysis-content li {
        color: #475569 !important;
      }
    }
  </style>
</body>
</html>
